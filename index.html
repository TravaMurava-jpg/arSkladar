<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Scene with Guiding Arrow</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

</head>

<body style="margin: 0; overflow: hidden;">

    <a-scene embedded arjs>
        <!-- Arrow Model at the bottom of the screen -->
        <a-entity id="arrow" gltf-model="scene.gltf" position="0 -1 -4" rotation="0 0 0"></a-entity>
        <!-- Camera -->
        <a-entity camera></a-entity>
    </a-scene>

    <script>
        // Dummy data for testing
        const qrData = ["1,2,3", "4,5,6", "7,8,9"];

        let currentTargetIndex = 0;
        let deviceOrientation = { alpha: 0, beta: 0, gamma: 0 };

        function rotateArrowToNextTarget() {
            // Get the next target coordinates from the QR data
            const targetCoordinates = qrData[currentTargetIndex].split(',').map(Number);

            // Calculate the rotation needed to point the arrow towards the target coordinates
            const rotation = calculateRotation(targetCoordinates);

            // Update the arrow's rotation
            document.getElementById('arrow').setAttribute('rotation', rotation);

            // Update the index for the next target
            currentTargetIndex = (currentTargetIndex + 1) % qrData.length;
        }

        function calculateRotation(targetCoordinates) {
            // Use the device orientation data to adjust the rotation
            const adjustedRotation = {
                x: targetCoordinates[0] - deviceOrientation.beta,
                y: targetCoordinates[1] - deviceOrientation.alpha,
                z: targetCoordinates[2] - deviceOrientation.gamma,
            };

            return `${adjustedRotation.x} ${adjustedRotation.y} ${adjustedRotation.z}`;
        }

        function handleOrientation(event) {
            // Update the device orientation data
            deviceOrientation = {
                alpha: event.alpha,
                beta: event.beta,
                gamma: event.gamma,
            };

            // Rotate the arrow to the next target
            rotateArrowToNextTarget();
        }

        // Listen for device orientation changes
        window.addEventListener('deviceorientation', handleOrientation);

        // Start the continuous updating
        setInterval(rotateArrowToNextTarget, 3000);
    </script>

</body>

</html>
